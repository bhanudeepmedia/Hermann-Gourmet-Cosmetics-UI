{% comment %}
  Clean Collection Template - Fixes duplicates and enables sorting
{% endcomment %}

<div class="page-header" style="background-color: var(--c-secondary); padding: 6rem 0; text-align: center; color: white; position: relative; overflow: hidden;">
    <div class="container relative z-10">
      <h1 class="collection-title">{{ collection.title }}</h1>
      {% if collection.description != blank %}
          <div class="collection-desc">{{ collection.description }}</div>
      {% endif %}
    </div>
</div>

<div class="container" style="margin-top: 4rem; margin-bottom: 8rem;">
    
    <!-- Controls -->
    <div class="collection-controls">
        <div class="filter-group">
           <span class="filter-label">FILTER BY</span>
           <label class="filter-check"><input type="checkbox" disabled> Availability</label>
           <label class="filter-check"><input type="checkbox" disabled> Price</label>
        </div>
        
        <div class="sort-group">
            <select id="sort-by" class="sort-select">
                {% assign sort_by = collection.sort_by | default: collection.default_sort_by %}
                <option value="manual" {% if sort_by == 'manual' %}selected="selected"{% endif %}>Featured</option>
                <option value="best-selling" {% if sort_by == 'best-selling' %}selected="selected"{% endif %}>Best Selling</option>
                <option value="title-ascending" {% if sort_by == 'title-ascending' %}selected="selected"{% endif %}>Alphabetical: A-Z</option>
                <option value="title-descending" {% if sort_by == 'title-descending' %}selected="selected"{% endif %}>Alphabetical: Z-A</option>
                <option value="price-ascending" {% if sort_by == 'price-ascending' %}selected="selected"{% endif %}>Price: Low to High</option>
                <option value="price-descending" {% if sort_by == 'price-descending' %}selected="selected"{% endif %}>Price: High to Low</option>
                <option value="created-descending" {% if sort_by == 'created-descending' %}selected="selected"{% endif %}>Date: New to Old</option>
                <option value="created-ascending" {% if sort_by == 'created-ascending' %}selected="selected"{% endif %}>Date: Old to New</option>
            </select>
        </div>
    </div>

    <!-- Product Grid -->
    <div class="product-grid-container">
        {% for product in collection.products %}
            {% render 'product-card', product: product %}
        {% else %}
            <div class="empty-collection">
               <p>No products found in this collection.</p>
               <a href="{{ routes.all_products_collection_url }}" class="btn-text">View all products</a>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if paginate.pages > 1 %}
        <div class="pagination">
            {{ paginate | default_pagination }}
        </div>
    {% endif %}
</div>

<style>
/* Collection Styles */
.collection-title { font-family: var(--font-heading); font-size: 3.5rem; margin: 0; }
.collection-desc { margin-top: 1rem; opacity: 0.9; max-width: 600px; margin-left: auto; margin-right: auto; line-height: 1.6; }

.collection-controls { 
  display: flex; justify-content: space-between; align-items: center; 
  padding-bottom: 1.5rem; border-bottom: 1px solid rgba(0,0,0,0.1); margin-bottom: 3rem; 
}
.filter-label { font-weight: 700; font-size: 0.8rem; letter-spacing: 1px; margin-right: 1rem; }
.filter-check { margin-right: 1.5rem; font-size: 0.9rem; color: #666; cursor: not-allowed; opacity: 0.6; }

.sort-select { 
  padding: 0.8rem 1.5rem; border: 1px solid #ddd; border-radius: 40px; 
  background: white; font-family: var(--font-body); cursor: pointer;
  min-width: 200px;
}

.product-grid-container {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 4rem 2rem;
}

.empty-collection { grid-column: 1/-1; text-align: center; padding: 4rem; }

/* Responsive */
@media(max-width: 768px) {
  .collection-controls { flex-direction: column; align-items: flex-start; gap: 1rem; }
  .sort-group { width: 100%; }
  .sort-select { width: 100%; }
}
</style>

<script>
  // Sorting Logic
  Shopify.queryParams = {};

  // Preserve existing query params
  if (location.search.length) {
    var params = location.search.substr(1).split('&');
    for (var i = 0; i < params.length; i++) {
      var keyValue = params[i].split('=');
      if (keyValue.length) {
        Shopify.queryParams[decodeURIComponent(keyValue[0])] = decodeURIComponent(keyValue[1]);
      }
    }
  }

  // Listen for change
  document.querySelector('#sort-by').addEventListener('change', function(e) {
    var value = e.target.value;
    Shopify.queryParams.sort_by = value;
    location.search = new URLSearchParams(Shopify.queryParams).toString();
  });
</script>
